# Flutter Insign 프로젝트 작업 내역

작업 날짜: 2025-11-01

## 1. 프로젝트 리네이밍 작업 (Quant → Insign)

### 변경된 파일들

#### 1.1 프로젝트 설정
- **pubspec.yaml**
  - `name: quant` → `name: insign`
  - `description: "디지털 계약서 관리 및 전자서명 플랫폼 - 인싸인"`
  - 추가 의존성: `shared_preferences: ^2.2.2`

#### 1.2 소스 코드
- **lib/main.dart**
  - `QuantApp` → `InsignApp` 클래스명 변경
  - `title: '시그널 픽'` → `title: '인싸인'`
  - **모든 lib/ 하위 .dart 파일**: `package:quant/` → `package:insign/` 자동 변경

#### 1.3 UI 텍스트 및 네비게이션
- **lib/app.dart**
  - Default title: `'Quant'` → `'인싸인'`
  - 네비게이션 라벨 변경:
    - '투자' → '계약서'
    - '내포트' → '내 계약서'
    - '팟캐스트' → '알림'
  - 아이콘 변경:
    - 계약서: `Icons.description_outlined`
    - 내 계약서: `Icons.folder_outlined`
    - 알림: `Icons.notifications_outlined`

- **lib/features/splash/view/splash_screen.dart**
  - "시그널 픽" → "인싸인"
  - 설명 텍스트: "디지털 계약서 관리 및\n전자서명 솔루션"

#### 1.4 테스트 파일
- **test/widget_test.dart**
  - `MyApp` → `InsignApp`으로 변경

#### 1.5 Android 설정
- **android/app/build.gradle**
  - `namespace "kr.signalpick"` → `namespace "app.insign"`
  - `applicationId "kr.signalpick"` → `applicationId "app.insign"`

- **android/app/src/main/AndroidManifest.xml**
  - `android:label="시그널 픽"` → `android:label="인싸인"`
  - `android:name="kr.signalpick.MainActivity"` → `android:name="app.insign.MainActivity"`

- **android/app/src/main/kotlin/app/insign/MainActivity.kt** (새로 생성)
  - 패키지명: `package app.insign`

#### 1.6 iOS 설정
- **ios/Runner/Info.plist**
  - `CFBundleDisplayName`: "시그널 픽" → "인싸인"
  - `CFBundleName`: "quant" → "insign"
  - Google Sign-In URL Scheme 추가
  - `GIDClientID` 추가

#### 1.7 Web 설정
- **web/index.html**
  - `title`: "quant" → "인싸인"
  - `description`: "디지털 계약서 관리 및 전자서명 플랫폼 - 인싸인"
  - Google Sign-In Client ID 업데이트

- **web/manifest.json**
  - `name`: "quant" → "insign"
  - `short_name`: "인싸인"

#### 1.8 IntelliJ IDEA 설정
- **.idea/modules.xml**
  - `flutter_quant.iml` → `insign_flutter.iml`
- **.idea/insign_flutter.iml** (새로 생성)
- **.idea/flutter_quant.iml** (삭제)
- **.idea/.name** (새로 생성): "insign_flutter"

---

## 2. Google OAuth 클라이언트 ID 적용

### 클라이언트 정보
- **Android Client ID**: `498213338840-5tuq94mf9ktt92speec4871vsi7rb22v.apps.googleusercontent.com`
- **Web Client ID**: `498213338840-q7v8crk85mstarb04bo5iusj6f022dng.apps.googleusercontent.com`
- **Project ID**: `insign-prj`

### 변경된 파일들

#### 2.1 Google 인증 서비스
- **lib/data/services/google_auth_service.dart**
```dart
static const String _webClientId = '498213338840-q7v8crk85mstarb04bo5iusj6f022dng.apps.googleusercontent.com';
static const String _androidClientId = '498213338840-5tuq94mf9ktt92speec4871vsi7rb22v.apps.googleusercontent.com';
```

#### 2.2 Android 설정
- **android/app/google-services.json**
  - Project ID: `insign-prj`
  - Package name: `app.insign`
  - OAuth Client IDs 추가

#### 2.3 iOS 설정
- **ios/Runner/Info.plist**
  - CFBundleURLSchemes 추가
  - GIDClientID 추가

#### 2.4 Web 설정
- **web/index.html**
  - Google Sign-In meta tag 업데이트

---

## 3. expo_insign 분석 및 Flutter 인증 로직 구현

### expo_insign 분석 결과

#### API 엔드포인트
- `POST /auth/register` - 회원가입
- `POST /auth/login` - 로그인
- `POST /auth/google` - Google 로그인
- `POST /auth/logout` - 로그아웃

#### 데이터 모델
```typescript
interface AuthResponse {
  user: {
    id: number;
    email: string;
    displayName?: string | null;
    lastLoginAt?: string | null;
    provider?: string;
    avatarUrl?: string | null;
  };
  accessToken: string;
  expiresIn: number;
}
```

### 새로 생성된 파일들

#### 3.1 설정 파일
- **lib/core/config/api_config.dart**
  - API Base URL 및 엔드포인트 정의
  - 기본값: `http://localhost:8081`

#### 3.2 API 클라이언트
- **lib/data/services/api_client.dart**
  - HTTP 요청 처리
  - GET, POST, PUT, DELETE 메서드 지원
  - 에러 핸들링 포함

#### 3.3 데이터 모델
- **lib/models/user.dart**
  - `User` 모델: id, email, displayName, lastLoginAt, provider, avatarUrl
  - `AuthResponse` 모델: user, accessToken, expiresIn
  - JSON 직렬화/역직렬화 메서드 포함

#### 3.4 Repository
- **lib/data/auth_repository.dart**
  - `register()`: 회원가입
  - `login()`: 이메일/비밀번호 로그인
  - `loginWithGoogle()`: Google ID Token으로 로그인
  - `logout()`: 로그아웃

#### 3.5 세션 관리
- **lib/data/services/session_service.dart**
  - SharedPreferences를 사용한 세션 저장
  - `saveSession()`: 세션 저장
  - `loadSession()`: 세션 로드
  - `getAccessToken()`: 액세스 토큰 가져오기
  - `clearSession()`: 세션 삭제

#### 3.6 인증 상태 관리
- **lib/features/auth/cubit/auth_cubit.dart** (완전히 재작성)
  - `checkSession()`: 앱 시작 시 세션 확인
  - `login()`: 이메일/비밀번호 로그인
  - `register()`: 회원가입
  - `loginWithGoogle()`: Google 로그인
  - `logout()`: 로그아웃
  - AuthState: `isLoggedIn`, `user` (User 모델 사용)

---

## 4. 의존성 추가

### pubspec.yaml에 추가된 패키지
```yaml
# Storage
shared_preferences: ^2.2.2
```

---

## 5. 다음 작업 예정

### 5.1 로그인 화면 업데이트
- expo_insign의 AuthScreen.tsx를 참고
- 직접 로그인 (이메일/비밀번호)
- Google 로그인 버튼
- 회원가입 화면 전환 버튼

### 5.2 회원가입 화면 생성
- 이름, 이메일, 비밀번호 입력
- 회원가입 후 로그인 화면으로 이동

### 5.3 main.dart 업데이트
- AuthRepository를 BLoC Provider에 등록
- 앱 시작 시 세션 확인 로직 추가

---

## 6. 주요 변경 사항 요약

### 프로젝트 정보
| 항목 | 이전 | 이후 |
|------|------|------|
| 프로젝트명 | quant | insign |
| 앱 이름 | 시그널 픽 | 인싸인 |
| 패키지명 | kr.signalpick | app.insign |
| 설명 | AI 기반 투자 신호 분석 | 디지털 계약서 관리 및 전자서명 |

### 인증 기능
| 기능 | 이전 | 이후 |
|------|------|------|
| 로그인 방식 | Google, Kakao만 | 직접 로그인 + Google (Kakao는 나중에) |
| 백엔드 연동 | 없음 (더미 데이터) | API 연동 구조 완성 |
| 세션 관리 | 없음 | SharedPreferences 기반 세션 관리 |
| 사용자 모델 | UserInfo (간단) | User (완전한 모델) |

### API 구조
```
lib/
├── core/
│   └── config/
│       └── api_config.dart          # API 설정
├── data/
│   ├── auth_repository.dart         # 인증 Repository
│   └── services/
│       ├── api_client.dart          # HTTP 클라이언트
│       ├── session_service.dart     # 세션 관리
│       └── google_auth_service.dart # Google 인증
├── models/
│   └── user.dart                    # User, AuthResponse 모델
└── features/
    └── auth/
        └── cubit/
            └── auth_cubit.dart      # 인증 상태 관리
```

---

## 7. 실행 전 필요 작업

### 7.1 의존성 설치
```bash
cd /mnt/c/android_prj/insign_flutter
flutter clean
flutter pub get
```

### 7.2 API 서버 설정
- `lib/core/config/api_config.dart`에서 `baseUrl`을 실제 서버 주소로 변경

### 7.3 Android 빌드
- 새로운 패키지명(`app.insign`)으로 첫 빌드 필요

---

## 8. 참고 사항

### expo_insign에서 가져온 개념
1. **인증 플로우**: 직접 회원가입/로그인 + Google OAuth
2. **API 구조**: RESTful API with JWT tokens
3. **세션 관리**: 토큰 기반 인증 with 만료 시간
4. **UI/UX**: 단일 화면에서 로그인/회원가입 전환

### Flutter 구현 특징
1. **BLoC 패턴**: Cubit을 사용한 상태 관리
2. **Repository 패턴**: 데이터 레이어 추상화
3. **의존성 주입**: Constructor injection 사용
4. **타입 안정성**: 강타입 모델 사용

---

## 9. 알려진 이슈

1. **테스트 파일**: widget_test.dart가 아직 실제 로직을 테스트하지 않음
2. **에러 처리**: UI에서 에러 메시지 표시 로직 미구현
3. **로딩 상태**: 로그인/회원가입 중 로딩 인디케이터 미구현
4. **토큰 갱신**: Access token 만료 시 자동 갱신 로직 없음

---

## 10. 파일 체크리스트

### 생성된 파일
- [x] lib/core/config/api_config.dart
- [x] lib/data/services/api_client.dart
- [x] lib/data/services/session_service.dart
- [x] lib/data/auth_repository.dart
- [x] lib/models/user.dart
- [x] android/app/src/main/kotlin/app/insign/MainActivity.kt
- [x] .idea/insign_flutter.iml
- [x] .idea/.name

### 수정된 파일
- [x] pubspec.yaml
- [x] lib/main.dart
- [x] lib/app.dart
- [x] lib/features/splash/view/splash_screen.dart
- [x] lib/features/auth/cubit/auth_cubit.dart
- [x] lib/data/services/google_auth_service.dart
- [x] test/widget_test.dart
- [x] android/app/build.gradle
- [x] android/app/src/main/AndroidManifest.xml
- [x] android/app/google-services.json
- [x] ios/Runner/Info.plist
- [x] web/index.html
- [x] web/manifest.json
- [x] .idea/modules.xml
- [x] CLAUDE.md

### 삭제된 파일
- [x] .idea/flutter_quant.iml
- [x] android/app/src/main/kotlin/kr/signalpick/MainActivity.kt (이전 패키지)

---

## 마무리

모든 기본 인증 인프라가 구축되었습니다. 다음 단계는:
1. 로그인/회원가입 UI 화면 구현
2. main.dart에서 AuthRepository Provider 등록
3. 라우터에 인증 가드 추가
4. 에러 처리 및 로딩 상태 UI 추가
