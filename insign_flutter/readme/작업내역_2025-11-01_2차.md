# 작업 내역 - 2025년 11월 1일 (2차)

## 📋 작업 개요
인싸인(Insign) Flutter 앱 개발 - 인증 시스템, 로그인/회원가입 UI 개선, 계약서 작성 기능 구현

---

## 🔧 주요 작업 내역

### 1. CLAUDE.md 파일 업데이트 및 개선
**파일**: `CLAUDE.md`

**개선 사항**:
- 프로젝트 개요에 백엔드 API URL 추가 (`https://in-sign.shop`)
- 아키텍처 문서화 개선 (core/config/ 디렉토리 포함)
- 인증 시스템 상세 설명 추가
  - 3가지 인증 방법 문서화 (Google, Kakao, Direct login)
  - 세션 플로우 상세 설명
  - Google OAuth 클라이언트 ID 정보
- API 통합 섹션 추가 (새로 추가됨)
  - API 설정 세부 정보
  - ApiClient 기능 설명
  - 사용 가능한 엔드포인트 목록
- 데이터 모델 섹션 추가
- 실용적인 "새 기능 추가하기" 가이드 추가
  - 새 화면 추가 방법
  - 새 라우트 추가 방법
  - 새 Repository 추가 방법
  - API 엔드포인트 추가 방법

---

### 2. 로그인/회원가입 기능 구현

#### 2.1 파일 누락 오류 수정
**파일**: `lib/core/router/app_router.dart`

**문제**: 존재하지 않는 `account_register_screen.dart` import로 인한 빌드 오류

**수정**: 해당 import 문 제거

#### 2.2 회원가입 페이지 구현
**파일**: `lib/features/auth/view/register_screen.dart` (신규 생성)

**구현 기능**:
- expo_insign 프로젝트 디자인을 참고한 UI
- 보라색 배경 + 중앙 흰색 카드 레이아웃
- 입력 필드:
  - 이름 (선택사항)
  - 이메일 (필수)
  - 비밀번호 (필수)
- 회원가입 완료 시 자동으로 로그인 페이지로 이동
- "이미 계정이 있으신가요? 로그인" 링크
- 로딩 인디케이터
- 에러 처리 및 토스트 메시지

#### 2.3 로그인 페이지 개선
**파일**: `lib/features/auth/view/login_screen.dart`

**변경 사항**:
1. **상단 콘텐츠 변경** (주식/코인 → 전자계약):
   - 기존: 로켓 이미지, 별/십자가 배경, "주식, 코인..." 문구
   - 변경: 문서 아이콘, "인싸인", "간편한 전자계약 플랫폼"

2. **레이아웃 전면 개편** (expo 디자인과 동일):
   - 기존: 상단 절반(로고) + 하단 절반(폼)
   - 변경: 전체 화면 보라색 배경 + 중앙 흰색 카드
   - 스크롤 가능한 단일 카드 구조

3. **카드 내부 구성 순서**:
   - 로고 (64x64, 보라색 배경, 문서 아이콘)
   - "인싸인" (22px, 굵게)
   - "간편한 전자계약 플랫폼" (14px, 회색)
   - 이메일 입력 필드
   - 비밀번호 입력 필드
   - 로그인 하기 버튼
   - **"계정이 없으신가요? 회원가입" 링크** (신규 추가)
   - ─── 또는 ─── 구분선
   - Google로 계속하기 버튼

4. **제거된 요소**:
   - 카카오 로그인 버튼
   - Apple 로그인 버튼
   - "간편 로그인으로 3초만에 시작" 텍스트
   - 약관 텍스트

#### 2.4 라우터 설정
**파일**: `lib/core/router/app_router.dart`

**추가된 경로**:
- `/auth/register` → RegisterScreen

---

### 3. 인증 가드 구현

#### 3.1 GoRouter 인증 가드
**파일**: `lib/core/router/app_router.dart`

**구현 내용**:
- `redirect` 함수로 인증 상태 확인
- 공개 페이지 목록 정의:
  - `/splash`
  - `/auth/login`
  - `/auth/register`
  - `/privacy-policy`
  - `/terms-of-service`
- 보호된 페이지 접근 시 자동 리다이렉트:
  - 로그인 안 됨 → `/auth/login?from={원래경로}`
  - 이미 로그인 → 로그인/회원가입 페이지 접근 시 `/home`으로

#### 3.2 로그인 필요 메시지
**파일**: `lib/features/auth/view/login_screen.dart`

**구현 내용**:
- URL 쿼리 파라미터 `from` 확인
- 보호된 페이지에서 리다이렉트된 경우 "로그인이 필요한 서비스입니다." 토스트 메시지 표시

#### 3.3 스플래시 화면 개선
**파일**: `lib/features/splash/view/splash_screen.dart`

**변경 사항**:
- 4초 후 로그인 상태에 따라 자동 분기:
  - 로그인 됨 → `/home`
  - 로그인 안 됨 → `/auth/login`

---

### 4. 계약서 작성 기능 구현

#### 4.1 계약서 작성 화면 UI
**파일**: `lib/features/contracts/view/create_contract_screen.dart` (신규 생성)

**구현된 섹션**:
1. **계약서 정보**
   - 계약서 제목 (필수)

2. **고객(의뢰인) 정보**
   - 이름 (필수)
   - 연락처 (선택)
   - 이메일 (선택)

3. **수행자 정보**
   - 이름 (선택)
   - 연락처 (선택)
   - 이메일 (선택)

4. **계약 조건**
   - 시작일 (DatePicker)
   - 종료일 (DatePicker)
   - 계약 금액 (숫자만 입력)

5. **계약 상세 내용**
   - 멀티라인 텍스트 입력 (8줄)

**주요 기능**:
- ✅ 폼 유효성 검사
- ✅ 날짜 선택기 (Material DatePicker)
- ✅ 숫자만 입력 (금액 필드)
- ✅ 로딩 인디케이터
- ✅ 에러 처리
- ✅ 토스트 메시지

**디자인**:
- 흰색 카드 스타일의 섹션별 구분
- 각 섹션에 아이콘과 제목
- 깔끔한 입력 필드 디자인
- 보라색 테마 일관성 유지

#### 4.2 API 연동
**파일**: `lib/data/contract_repository.dart`

**추가된 클래스**:
```dart
class CreateContractPayload {
  final int? templateId;
  final String name;
  final String clientName;
  final String? clientContact;
  final String? clientEmail;
  final String? performerName;
  final String? performerEmail;
  final String? performerContact;
  final String? startDate;
  final String? endDate;
  final String? amount;
  final String? details;
  final Map<String, dynamic>? metadata;

  // toJson() 메서드 포함
}
```

**추가된 메서드**:
```dart
Future<Contract> createContract({
  required CreateContractPayload payload,
  String? token,
})
```

**특징**:
- expo_insign 프로젝트의 API 구조와 동일
- performer 정보를 nested object로 전송
- 선택적 필드는 null일 경우 JSON에서 제외

#### 4.3 라우팅 및 연동
**파일**: `lib/core/router/app_router.dart`

**추가된 경로**:
- `/create-contract` → CreateContractScreen

**파일**: `lib/features/home/view/home_screen.dart`

**변경 사항**:
- `_handleCreateContract()` 메서드를 async로 변경
- 계약서 작성 화면에서 돌아올 때 결과값 확인
- `result == true`일 경우 자동으로 계약서 목록 새로고침

**사용자 흐름**:
```
홈 화면
  ↓ (새 계약 작성 버튼 클릭)
계약서 작성 화면
  ↓ (정보 입력 후 저장 버튼)
API 호출 → 서버에 저장
  ↓ (성공)
홈 화면으로 돌아가기 + 자동 새로고침
  ↓
최근 계약 목록에 새 계약서 표시
```

---

## 📁 수정/생성된 파일 목록

### 신규 생성
1. `lib/features/auth/view/register_screen.dart` - 회원가입 화면
2. `lib/features/contracts/view/create_contract_screen.dart` - 계약서 작성 화면

### 수정
1. `CLAUDE.md` - 프로젝트 문서 개선
2. `lib/core/router/app_router.dart` - 라우팅 및 인증 가드
3. `lib/features/auth/view/login_screen.dart` - 로그인 UI 전면 개편
4. `lib/features/splash/view/splash_screen.dart` - 로그인 상태 분기
5. `lib/features/home/view/home_screen.dart` - 계약서 작성 버튼 연동
6. `lib/data/contract_repository.dart` - 계약서 생성 API 추가

---

## 🎯 구현 완료된 기능

### 인증 & 보안
- [x] 회원가입 페이지
- [x] 로그인 페이지 UI 개선
- [x] GoRouter 인증 가드
- [x] 보호된 페이지 자동 리다이렉트
- [x] 로그인 필요 메시지 표시
- [x] 스플래시 화면 자동 분기

### 계약서 관리
- [x] 계약서 작성 화면 UI
- [x] 폼 유효성 검사
- [x] 날짜 선택 기능
- [x] 계약서 생성 API 연동
- [x] 저장 후 자동 새로고침

---

## 📊 API 엔드포인트

### 사용 중인 엔드포인트
- `POST /auth/register` - 회원가입
- `POST /auth/login` - 로그인
- `POST /auth/google` - Google OAuth
- `GET /contracts` - 계약서 목록 조회
- `POST /contracts` - 계약서 생성

---

## 🔄 다음 단계 제안

### 우선순위 높음
1. 계약서 상세 보기 화면
2. 계약서 목록 화면 개선
3. 템플릿 목록 및 선택 기능

### 우선순위 중간
4. 계약서 수정/삭제 기능
5. 서명 기능 (SignaturePad)
6. 계약서 공유 기능

### 우선순위 낮음
7. 이미지 첨부 기능
8. 계약서 미리보기
9. 임시 저장 기능
10. 오프라인 지원

---

## 🐛 알려진 이슈

없음

---

## 📝 참고 사항

### expo_insign 프로젝트 참고
- `app/home.tsx` - 홈 화면 레이아웃 및 통계
- `app/create-contract.tsx` - 계약서 작성 (2,863줄, 매우 복잡)
- `src/api/contracts.ts` - 계약서 API 인터페이스
- `src/screens/AuthScreen.tsx` - 로그인/회원가입 통합 화면

### 디자인 가이드
- 주 색상: `#6A4C93` (보라색)
- 배경색: `#F8F9FA` (연한 회색)
- 카드 배경: 흰색
- 테두리 색: `#E5E7EB`
- 입력 필드 배경: `#F9FAFB`

### 코드 컨벤션
- 화면: `*_screen.dart`
- 위젯: `*_widget.dart`
- Repository: `*_repository.dart`
- 모델: 단수형 명사
- 한국어 UI, 영어 코드/주석

---

## ✅ 체크리스트

- [x] CLAUDE.md 업데이트
- [x] 회원가입 기능 구현
- [x] 로그인 UI 개선
- [x] 인증 가드 구현
- [x] 계약서 작성 기능 구현
- [x] API 연동 완료
- [x] 에러 처리 추가
- [x] 작업 내역 문서화

---

**작업 완료 시간**: 2025년 11월 1일
**작업자**: Claude Code
**프로젝트**: 인싸인 (Insign) Flutter App
